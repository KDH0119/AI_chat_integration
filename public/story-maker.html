<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Story Maker</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+KR:wght@400;600;700&display=swap">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/variable/pretendardvariable.css">
    <link rel="stylesheet" href="story-maker.css">
</head>
<body>
    <div class="story-app">
        <header class="top-bar">
            <div class="api-panel">
                <div class="api-group">
                    <label for="globalGoogleApiKey">Gemini API Key</label>
                    <div class="api-row">
                        <input type="password" id="globalGoogleApiKey" placeholder="AIza..." autocomplete="off">
                        <button id="saveGlobalGoogleKey" class="btn btn-dark">μ €μ¥</button>
                    </div>
                    <div class="api-status" id="googleKeyStatus"></div>
                </div>
                <div class="api-group">
                    <label for="globalNovelApiKey">NovelAI API Key</label>
                    <div class="api-row">
                        <input type="password" id="globalNovelApiKey" placeholder="pst-..." autocomplete="off">
                        <button id="saveGlobalNovelKey" class="btn btn-dark">μ €μ¥</button>
                    </div>
                    <div class="api-status" id="novelKeyStatus"></div>
                </div>
            </div>
            <div class="hero">
                <span class="eyebrow">Story Maker</span>
                <h1>μ¤ν† λ¦¬ μ μ‘ ν†µν•© μ μ‘κΈ°</h1>
                <p>ν…ν”λ¦Ώ κ²°ν•©, μ΄λ―Έμ§€ μƒμ„±, ν•©μ„±, λ…ΈνΈκΉμ§€ ν• κ³µκ°„μ—μ„ κ΄€λ¦¬ν•©λ‹λ‹¤.</p>
            </div>
        </header>

        <nav class="menu-bar">
            <button class="menu-item active" data-view="prompt">ν”„λ΅¬ν”„νΈ</button>
            <button class="menu-item" data-view="story">ν‚¤μ›λ“λ¶ λ©λ΅</button>
            <button class="menu-item" data-view="start">μ΄λ―Έμ§€ μƒμ„±</button>
            <button class="menu-item" data-view="media">λ°°κ²½ ν•©μ„±</button>
        </nav>

        <main class="content">
            <section id="view-prompt" class="view active">
                <div class="view-header">
                    <h2>ν”„λ΅¬ν”„νΈ ν…ν”λ¦Ώ κ²°ν•©</h2>
                    <p>ν…ν”λ¦Ώμ„ μ„ νƒν•κ³  μ…λ ¥ν• ν”„λ΅¬ν”„νΈλ¥Ό κ²°ν•©ν•΄ μ™„μ„±λ³Έμ„ μƒμ„±ν•©λ‹λ‹¤.</p>
                </div>
                <div class="prompt-grid">
                    <div class="card">
                        <div class="card-title">ν…ν”λ¦Ώ μ„ νƒ</div>
                        <label class="field-label" for="templateSelect">ν…ν”λ¦Ώ μ„ νƒ</label>
                        <select id="templateSelect" class="input-field">
                            <option value="roleplay_v1">λ΅¤ν”λ μ‰ v1</option>
                            <option value="roleplay_v2">λ΅¤ν”λ μ‰ v2</option>
                            <option value="roleplay_v3">λ΅¤ν”λ μ‰ v3</option>
                            <option value="simulation_v1">μ‹λ®¬λ μ΄μ… v1</option>
                            <option value="simulation_v2">μ‹λ®¬λ μ΄μ… v2</option>
                            <option value="simulation_v3">μ‹λ®¬λ μ΄μ… v3</option>
                        </select>
                        <label class="field-label" for="templatePromptInput">μ΄μ•ΌκΈ°</label>
                        <textarea id="templatePromptInput" class="input-area" rows="10" placeholder="μ„Έκ³„κ΄€, μ¥λ¥΄, μΊλ¦­ν„°, μ„μ‚¬ λ“±μ„ μ…λ ¥ν•μ„Έμ”."></textarea>
                        <p class="helper-text">ν…ν”λ¦Ώμ€ κ°€μ΄λ“λΌμΈμΌλ΅ μ „λ‹¬λκ³ , μ΄μ•ΌκΈ°λ¥Ό λ°”νƒ•μΌλ΅ AIκ°€ μ™„μ„± ν”„λ΅¬ν”„νΈλ¥Ό μƒμ„±ν•©λ‹λ‹¤.</p>
                        <p class="helper-text">μ”μ²­ λ¬Έμ¥: "μ΄ μ΄μ•ΌκΈ°λ¥Ό μ΄ ν…ν”λ¦Ώ ν”„λ΅¬ν”„νΈμ— λ§μ¶°μ„ μ™„λ²½ν•κ² λ‹¤μ‹ μ§μ¤."</p>
                    </div>
                    <div class="card">
                        <div class="card-title">μ™„μ„±λ ν”„λ΅¬ν”„νΈ</div>
                        <div class="output-actions">
                            <button id="generateFinalPrompt" class="btn btn-dark">AI μƒμ„±</button>
                            <button id="copyFinalPrompt" class="btn btn-outline">λ³µμ‚¬</button>
                        </div>
                        <textarea id="finalPromptOutput" class="output-area" rows="14" readonly></textarea>
                    </div>
                </div>
            </section>

            <section id="view-story" class="view">
                <div class="view-header">
                    <h2>ν‚¤μ›λ“λ¶ λ©λ΅ λ…ΈνΈ</h2>
                    <p>λ…ΈνΈλ¥Ό μ¶”κ°€ν•΄ ν‚¤μ›λ“λ¶μ„ μ •λ¦¬ν•μ„Έμ”. μ λ©κ³Ό λ‚΄μ©μ€ μ§μ ‘ μμ •ν•λ©΄ λ©λ‹λ‹¤.</p>
                </div>
                <div class="notes-grid">
                    <div class="note-card">
                        <div class="note-top">
                            <h3 class="note-title">λ…ΈνΈ μ λ©</h3>
                            <button class="note-copy" data-copy-note>λ³µμ‚¬</button>
                        </div>
                        <p class="note-body">λ…ΈνΈ λ‚΄μ©μ„ μ…λ ¥ν•μ„Έμ”.</p>
                    </div>
                    <div class="note-card">
                        <div class="note-top">
                            <h3 class="note-title">λ…ΈνΈ μ λ©</h3>
                            <button class="note-copy" data-copy-note>λ³µμ‚¬</button>
                        </div>
                        <p class="note-body">λ…ΈνΈ λ‚΄μ©μ„ μ…λ ¥ν•μ„Έμ”.</p>
                    </div>
                    <div class="note-card">
                        <div class="note-top">
                            <h3 class="note-title">λ…ΈνΈ μ λ©</h3>
                            <button class="note-copy" data-copy-note>λ³µμ‚¬</button>
                        </div>
                        <p class="note-body">λ…ΈνΈ λ‚΄μ©μ„ μ…λ ¥ν•μ„Έμ”.</p>
                    </div>
                    <div class="note-card">
                        <div class="note-top">
                            <h3 class="note-title">λ…ΈνΈ μ λ©</h3>
                            <button class="note-copy" data-copy-note>λ³µμ‚¬</button>
                        </div>
                        <p class="note-body">λ…ΈνΈ λ‚΄μ©μ„ μ…λ ¥ν•μ„Έμ”.</p>
                    </div>
                    <div class="note-card">
                        <div class="note-top">
                            <h3 class="note-title">λ…ΈνΈ μ λ©</h3>
                            <button class="note-copy" data-copy-note>λ³µμ‚¬</button>
                        </div>
                        <p class="note-body">λ…ΈνΈ λ‚΄μ©μ„ μ…λ ¥ν•μ„Έμ”.</p>
                    </div>
                    <div class="note-card">
                        <div class="note-top">
                            <h3 class="note-title">λ…ΈνΈ μ λ©</h3>
                            <button class="note-copy" data-copy-note>λ³µμ‚¬</button>
                        </div>
                        <p class="note-body">λ…ΈνΈ λ‚΄μ©μ„ μ…λ ¥ν•μ„Έμ”.</p>
                    </div>
                    <div class="note-card">
                        <div class="note-top">
                            <h3 class="note-title">λ…ΈνΈ μ λ©</h3>
                            <button class="note-copy" data-copy-note>λ³µμ‚¬</button>
                        </div>
                        <p class="note-body">λ…ΈνΈ λ‚΄μ©μ„ μ…λ ¥ν•μ„Έμ”.</p>
                    </div>
                    <div class="note-card">
                        <div class="note-top">
                            <h3 class="note-title">λ…ΈνΈ μ λ©</h3>
                            <button class="note-copy" data-copy-note>λ³µμ‚¬</button>
                        </div>
                        <p class="note-body">λ…ΈνΈ λ‚΄μ©μ„ μ…λ ¥ν•μ„Έμ”.</p>
                    </div>
                    <div class="note-card">
                        <div class="note-top">
                            <h3 class="note-title">λ…ΈνΈ μ λ©</h3>
                            <button class="note-copy" data-copy-note>λ³µμ‚¬</button>
                        </div>
                        <p class="note-body">λ…ΈνΈ λ‚΄μ©μ„ μ…λ ¥ν•μ„Έμ”.</p>
                    </div>
                    <div class="note-card">
                        <div class="note-top">
                            <h3 class="note-title">λ…ΈνΈ μ λ©</h3>
                            <button class="note-copy" data-copy-note>λ³µμ‚¬</button>
                        </div>
                        <p class="note-body">λ…ΈνΈ λ‚΄μ©μ„ μ…λ ¥ν•μ„Έμ”.</p>
                    </div>
                </div>
            </section>

            <section id="view-start" class="view">
                <div class="view-header">
                    <h2>μ΄λ―Έμ§€ μƒμ„±</h2>
                    <p>λ©”λ¨μ¥ κΈ°λ° μƒμ„± κΈ°λ¥λ§ κ°€μ Έμ™€ λ‹¨μν™”λ μ›ν¬ν”λ΅μ°λ΅ μ κ³µν•©λ‹λ‹¤.</p>
                </div>
                <div class="generator-layout" id="memoGenerator">
                    <aside class="generator-panel generator-settings">
                        <div class="generator-section">
                            <h3>ν”„λ΅¬ν”„νΈ</h3>
                            <label class="field-label" for="memoArtistTags">μ‘κ°€/ν™”ν’ νƒκ·Έ</label>
                            <textarea id="memoArtistTags" class="input-area" rows="4" placeholder="artist name, style..."></textarea>
                            <label class="field-label" for="memoNegativeTags">λ„¤κ±°ν‹°λΈ νƒκ·Έ</label>
                            <textarea id="memoNegativeTags" class="input-area" rows="4" placeholder="low quality, bad anatomy..."></textarea>
                            <label class="field-label" for="memoCharacterTags">μΊλ¦­ν„° 1 νƒκ·Έ</label>
                            <textarea id="memoCharacterTags" class="input-area" rows="4" placeholder="1girl, long hair, blue eyes..."></textarea>
                        </div>
                        <div class="generator-section">
                            <h3>μƒμ„± μ„¤μ •</h3>
                            <label class="field-label" for="memoImageSize">ν•΄μƒλ„</label>
                            <select id="memoImageSize" class="input-field">
                                <option value="832x1216">Portrait (832 Γ— 1216)</option>
                                <option value="1216x832">Landscape (1216 Γ— 832)</option>
                                <option value="1024x1024">Square (1024 Γ— 1024)</option>
                            </select>
                            <div class="delay-row">
                                <label class="field-label" for="memoRequestDelay">λ”λ μ΄</label>
                                <div class="delay-control">
                                    <input type="range" id="memoRequestDelay" min="0" max="10" step="0.1" value="0">
                                    <span id="memoDelayValue">0s</span>
                                </div>
                            </div>
                            <button id="openMemoAdvancedSettings" class="btn btn-outline btn-block">κ³ κΈ‰ μ„¤μ •</button>
                        </div>
                    </aside>

                    <section class="generator-panel generator-preview">
                        <div class="generator-preview-header">
                            <div>
                                <h3>μƒμ„± κ²°κ³Ό</h3>
                                <span id="memoStatus" class="memo-status"></span>
                            </div>
                            <div class="preview-actions">
                                <button id="memoGenerateAll" class="btn btn-dark">μ „μ²΄ μƒμ„±</button>
                                <button id="memoDownloadAll" class="btn btn-outline" disabled>μ „μ²΄ μ €μ¥</button>
                            </div>
                        </div>
                        <div id="memoProgressSection" class="memo-progress is-hidden">
                            <div class="memo-progress-bar">
                                <div id="memoProgressFill" class="memo-progress-fill"></div>
                            </div>
                            <div class="memo-progress-info">
                                <span id="memoLoadingText">μ¤€λΉ„ μ¤‘...</span>
                                <span id="memoProgressText">0 / 0</span>
                            </div>
                        </div>
                        <div id="memoPreviewContainer" class="memo-preview-grid">
                            <div class="memo-empty">
                                <p>λ©”λ¨μ¥μ„ μƒμ„±ν• λ’¤ μ „μ²΄ μƒμ„±μ„ λλ¬μ£Όμ„Έμ”.</p>
                            </div>
                        </div>
                        <div id="memoLoadingOverlay" class="memo-loading is-hidden">
                            <div class="memo-spinner"></div>
                        </div>
                    </section>

                    <aside class="generator-panel generator-memo">
                        <div class="generator-section-header">
                            <div>
                                <h3>λ©”λ¨μ¥</h3>
                                <p>λ©”λ¨μ¥μ„ μ¶”κ°€ν•κ³  μƒν™© νƒκ·Έλ¥Ό κ΄€λ¦¬ν•μ„Έμ”.</p>
                            </div>
                            <div class="memo-header-actions">
                                <button id="memoImportJson" class="btn-icon" title="κ°€μ Έμ¤κΈ°">π“‚</button>
                                <button id="memoExportJson" class="btn-icon" title="λ‚΄λ³΄λ‚΄κΈ°">π’Ύ</button>
                                <input type="file" id="memoJsonFile" accept=".json" hidden>
                            </div>
                        </div>
                        <div class="memo-controls">
                            <span id="memoCountBadge" class="memo-count">0/200</span>
                            <button id="memoAddPad" class="btn btn-dark btn-sm">+ μƒ λ©”λ¨</button>
                            <button id="memoOpenAll" class="btn btn-outline btn-sm">μ „μ²΄λ³΄κΈ°</button>
                        </div>
                        <div id="memoPadList" class="memo-list"></div>
                    </aside>
                </div>
            </section>

            <section id="view-media" class="view">
                <div class="view-header">
                    <h2>λ°°κ²½ ν•©μ„±</h2>
                    <p>Gemini λ°°κ²½ ν•©μ„± κΈ°λ¥κ³Ό λ™μΌν•κ² λ™μ‘ν•©λ‹λ‹¤.</p>
                </div>
                <div class="compose-layout">
                    <div class="compose-left">
                        <div class="compose-section">
                            <div class="compose-section-header">
                                <div>
                                    <h3>λ°°κ²½ μ΄λ―Έμ§€</h3>
                                    <p>1μ¥λ§ μ„ νƒ</p>
                                </div>
                                <div class="compose-actions">
                                    <input type="file" id="composeBgInput" accept="image/*" hidden>
                                    <button id="btnAttachComposeBg" class="btn btn-outline btn-sm">λ°°κ²½ μ—…λ΅λ“</button>
                                    <button id="btnRemoveComposeBg" class="btn btn-outline btn-sm">μ§€μ°κΈ°</button>
                                </div>
                            </div>
                            <div id="composeBgPreview" class="compose-preview-box">
                                <span class="muted">λ°°κ²½ μ΄λ―Έμ§€κ°€ μ—†μµλ‹λ‹¤.</span>
                            </div>
                        </div>

                        <div class="compose-section">
                            <div class="compose-section-header">
                                <div>
                                    <h3>μΊλ¦­ν„° μ΄λ―Έμ§€</h3>
                                    <p>μ—¬λ¬ μ¥ μ„ νƒ κ°€λ¥</p>
                                </div>
                                <div class="compose-actions">
                                    <input type="file" id="composeCharInput" accept="image/*" multiple hidden>
                                    <button id="btnAttachComposeChars" class="btn btn-outline btn-sm">μΊλ¦­ν„° μ—…λ΅λ“</button>
                                    <button id="btnClearComposeChars" class="btn btn-outline btn-sm">μ§€μ°κΈ°</button>
                                </div>
                            </div>
                            <div id="composeCharList" class="compose-thumb-list">
                                <span class="muted">μΊλ¦­ν„° μ΄λ―Έμ§€λ¥Ό μ¶”κ°€ν•΄μ£Όμ„Έμ”.</span>
                            </div>
                        </div>

                        <div class="compose-section">
                            <label class="field-label" for="composeImageSize">μ΄λ―Έμ§€ μ‚¬μ΄μ¦</label>
                            <select id="composeImageSize" class="input-field">
                                <option value="default">κΈ°λ³Έ (μ„¤μ • μ•ν•¨)</option>
                                <option value="1K">1K</option>
                                <option value="2K">2K</option>
                                <option value="4K">4K</option>
                            </select>
                            <label class="field-label" for="composePrompt">ν•©μ„± ν”„λ΅¬ν”„νΈ</label>
                            <textarea id="composePrompt" class="input-area" rows="4" placeholder="λ°°κ²½κ³Ό μΊλ¦­ν„°λ¥Ό μμ—°μ¤λ½κ² ν•©μ„±ν•΄μ¤. μΊλ¦­ν„°μ ν¬μ¦μ™€ μ¤νƒ€μΌμ€ μ μ§€ν•κ³ , λ°°κ²½ μ΅°λ…μ— λ§μ¶° μ΅°λ…μ„ λ³΄μ •ν•΄μ¤."></textarea>
                            <div class="compose-controls">
                                <button id="btnGenerateCompose" class="btn btn-dark">ν•©μ„± μ‹μ‘</button>
                                <button id="btnStopCompose" class="btn btn-outline btn-sm">μ¤‘λ‹¨</button>
                                <button id="btnDownloadAllCompose" class="btn btn-outline btn-sm">μ „μ²΄ μ €μ¥</button>
                            </div>
                            <p id="composeStatus" class="compose-status"></p>
                        </div>
                    </div>

                    <div class="compose-right">
                        <div class="compose-section-header">
                            <div>
                                <h3>ν•©μ„± κ²°κ³Ό</h3>
                                <p>μΊλ¦­ν„° μλ§νΌ μμ°¨ μƒμ„±</p>
                            </div>
                        </div>
                        <div id="composeResultList" class="compose-result-list">
                            <div class="compose-empty">λ°°κ²½+μΊλ¦­ν„°λ¥Ό μ„ νƒν•κ³  ν•©μ„±μ„ μ‹μ‘ν•μ„Έμ”.</div>
                        </div>
                    </div>
                </div>
            </section>
        </main>
        <div id="toast" class="toast">λ³µμ‚¬λμ—μµλ‹λ‹¤.</div>
    </div>

    <div id="memoPadModal" class="memo-modal is-hidden">
        <div class="memo-modal-content">
            <div class="memo-modal-header">
                <input type="text" id="memoPadTitle" class="memo-modal-title" placeholder="λ©”λ¨ μ λ©">
                <button id="memoPadClose" class="btn-icon">β•</button>
            </div>
            <div class="memo-modal-body">
                <label class="field-label" for="memoPadTags">μΊλ¦­ν„° 1 μƒν™© νƒκ·Έ</label>
                <textarea id="memoPadTags" class="input-area" rows="6" placeholder="standing, smiling, indoor..."></textarea>
                <p class="helper-text">μƒν™© νƒκ·Έλ¥Ό μ…λ ¥ν•λ©΄ μλ™μΌλ΅ μ €μ¥λ©λ‹λ‹¤.</p>
            </div>
        </div>
    </div>

    <div id="memoAdvancedSettingsModal" class="memo-modal is-hidden">
        <div class="memo-modal-content">
            <div class="memo-modal-header">
                <h3>κ³ κΈ‰ μ„¤μ •</h3>
                <button id="memoCloseAdvancedSettings" class="btn-icon">β•</button>
            </div>
            <div class="memo-modal-body">
                <label class="field-label" for="memoInputSteps">Sampling Steps</label>
                <input type="number" id="memoInputSteps" class="input-field" value="28">

                <label class="field-label" for="memoInputPromptScale">Prompt Guidance</label>
                <input type="number" id="memoInputPromptScale" class="input-field" value="6" step="0.1">

                <label class="field-label" for="memoInputPromptRescale">Prompt Rescale</label>
                <input type="number" id="memoInputPromptRescale" class="input-field" value="0.1" step="0.1">

                <div class="memo-toggle">
                    <input type="checkbox" id="memoChkVarietyPlus">
                    <label for="memoChkVarietyPlus">Variety+ (λ‹¤μ–‘μ„± μ¦κ°€)</label>
                </div>
                <p class="helper-text">μ²΄ν¬ μ‹ κµ¬λ„κ°€ λ” λ‹¤μ–‘ν•΄μ§ μ μμµλ‹λ‹¤.</p>

                <div class="memo-ref">
                    <h4>Reference Image (V4.5)</h4>
                    <input type="file" id="memoRefImageInput" accept="image/*" class="input-field">
                    <div id="memoRefImagePreviewContainer" class="memo-ref-preview is-hidden">
                        <img id="memoRefImagePreview" src="" alt="ref preview">
                        <button id="memoRemoveRefImage" class="btn btn-outline btn-sm">μ΄λ―Έμ§€ μ‚­μ </button>
                    </div>
                    <div id="memoStyleAwareContainer" class="memo-toggle is-hidden">
                        <input type="checkbox" id="memoChkStyleAware">
                        <label for="memoChkStyleAware">Style Aware (ν™”ν’ λ³µμ‚¬)</label>
                    </div>
                    <div id="memoRefStrengthContainer" class="memo-strength is-hidden">
                        <label for="memoRngRefStrength">Reference Strength: <span id="memoRefStrengthValue">1.0</span></label>
                        <input type="range" id="memoRngRefStrength" min="0.01" max="1" step="0.01" value="1">
                    </div>
                </div>
                <button id="memoSaveAdvancedSettings" class="btn btn-dark btn-block">μ €μ¥</button>
            </div>
        </div>
    </div>

    <div id="memoAllModal" class="memo-modal is-hidden">
        <div class="memo-modal-content memo-modal-wide">
            <div class="memo-modal-header">
                <h3>μ „μ²΄ λ©”λ¨μ¥</h3>
                <button id="memoAllClose" class="btn-icon">β•</button>
            </div>
            <div class="memo-modal-body">
                <div id="memoAllList" class="memo-all-list"></div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="story-maker.js"></script>
</body>
</html>
